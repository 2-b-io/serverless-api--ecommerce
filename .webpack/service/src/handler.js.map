{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/functions/setting-image/create.js","webpack:///./src/handler.js","webpack:///./src/infrastructure/config.js","webpack:///./src/infrastructure/mongoose.js","webpack:///./src/models/setting-image.js","webpack:///./src/services/setting-image.js","webpack:///external \"@babel/runtime/helpers/objectSpread\"","webpack:///external \"http-status-codes\"","webpack:///external \"joi\"","webpack:///external \"mongoose\"","webpack:///external \"ms\""],"names":["SCHEMA","joi","object","keys","identifier","string","trim","required","settings","req","session","body","JSON","parse","values","validate","settingImage","settingImageService","create","statusCode","BAD_REQUEST","CREATED","resource","mongo","uri","process","env","MONGODB_URI","ttl","MONGODB_TTL","apps","WEBAPP","EC_DEMO","connection","connectionExpiration","ms","config","connect","console","log","readyState","mongoose","createConnection","useNewUrlParser","useCreateIndex","bufferCommands","bufferMaxEntries","clearTimeout","setTimeout","close","register","modelName","schema","modelNames","includes","model","Promise","Schema","type","String","index","Types","Mixed","default","timestamps","collection","setting","SettingImageModel","createSettingImageModel","save","get","findOne"],"mappings":"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","file":"src/handler.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/handler.js\");\n","import { BAD_REQUEST, CREATED } from 'http-status-codes'\nimport joi from 'joi'\n\n// import resource from 'rest/resource'\n// import authorize from 'middlewares/authorize'\nimport config from 'infrastructure/config'\nimport settingImageService from 'services/setting-image'\n\nconst SCHEMA = joi.object().keys({\n  identifier: joi.string().trim().required(),\n  settings: joi.object()\n})\n\nexport default (\n  async (req, session) => {\n    const body = JSON.parse(req.body)\n    const values = await joi.validate(body, SCHEMA)\n    const settingImage = await settingImageService.create(values)\n\n    if (!settingImage) {\n      return {\n        statusCode: BAD_REQUEST\n      }\n    }\n\n    return {\n      statusCode: CREATED,\n      resource: {\n        ...settingImage\n      }\n    }\n  }\n)\n","export { default as SETTING__IMAGE___create } from './functions/setting-image/create'\nexport { default as SETTING__IMAGE___get } from './functions/setting-image/get'\n","export default {\n  mongo: {\n    uri: process.env.MONGODB_URI,\n    ttl: process.env.MONGODB_TTL\n  },\n  apps: {\n    WEBAPP: 'webapp',\n    EC_DEMO: 'ec-demo',\n  }\n}\n","// Using Mongoose With AWS Lambda: https://mongoosejs.com/docs/\nimport mongoose from 'mongoose'\nimport ms from 'ms'\nimport config from 'infrastructure/config'\n\nlet connection = null\nlet connectionExpiration = null\nconst ttl = ms(config.mongo.ttl || '30s')\n\nconst connect = async () => {\n  console.log('connect');\n  // Because `connection` is in the global scope, Lambda may retain it between\n  // function calls thanks to `callbackWaitsForEmptyEventLoop`.\n  // This means your Lambda function doesn't have to go through the\n  // potentially expensive process of connecting to MongoDB every time.\n  if (connection === null || connection.readyState !== 1) {\n    console.log('Connecting to MongoDB...')\n\n    connection = await mongoose.createConnection(config.mongo.uri, {\n      useNewUrlParser: true,\n      useCreateIndex: true,\n      // Buffering means mongoose will queue up operations if it gets\n      // disconnected from MongoDB and send them when it reconnects.\n      // With serverless, better to fail fast if not connected.\n      bufferCommands: false, // Disable mongoose buffering\n      bufferMaxEntries: 0 // and MongoDB driver buffering\n    })\n\n    console.log('MongoDB connected!')\n  } else {\n    console.log('Reuse alive MongoDB connection.')\n  }\n\n  // reset expiration\n  clearTimeout(connectionExpiration)\n\n  connectionExpiration = setTimeout(() => {\n    console.log('MongoDB Connection expired!')\n    connection.close()\n  }, ttl)\n\n  return connection\n}\n\nexport const register = async (modelName, schema) => {\n  console.log('register');\n  const connection = await connect()\n\n  if (connection.modelNames().includes(modelName)) {\n    return connection.model(modelName)\n  } else {\n    return connection.model(modelName, schema)\n  }\n}\n\n// don't use `mpromise`\nmongoose.Promise = Promise\nexport default mongoose\n","import mongoose, { register } from 'infrastructure/mongoose'\n\nconst schema = mongoose.Schema({\n  identifier: {\n    type: String,\n    index: true\n  },\n  settings: {\n    type: mongoose.Schema.Types.Mixed,\n    default: {}\n  }\n}, {\n  timestamps: true,\n  collection: 'SettingImage'\n})\n\nexport default () => register('SettingImage', schema)\n","import createSettingImageModel from 'models/setting-image'\n\nconst create = async ({ identifier, setting = {} }) => {\n  console.log('identifier', identifier);\n\n  const SettingImageModel = await createSettingImageModel()\n\n  const settingImage = await new SettingImageModel({\n    identifier,\n    setting\n  }).save()\n\n  if (!settingImage) {\n    return null\n  }\n\n  return settingImage\n}\n\nconst get = async (identifier) => {\n  return await SettingImageModel.findOne({\n    identifier\n  })\n}\n\n// // TODO:  auto delete if upload handler from upload tool\n\n\nexport default {\n  create,\n  get\n}\n","module.exports = require(\"@babel/runtime/helpers/objectSpread\");","module.exports = require(\"http-status-codes\");","module.exports = require(\"joi\");","module.exports = require(\"mongoose\");","module.exports = require(\"ms\");"],"sourceRoot":""}