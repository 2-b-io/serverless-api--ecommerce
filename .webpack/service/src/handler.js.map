{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/functions/setting-image/create.js","webpack:///./src/functions/setting-image/get.js","webpack:///./src/handler.js","webpack:///./src/infrastructure/config.js","webpack:///./src/infrastructure/mongoose.js","webpack:///./src/models/setting-image.js","webpack:///./src/rest/resource.js","webpack:///./src/services/setting-image.js","webpack:///./src/transformers/index.js","webpack:///./src/transformers/setting-image.js","webpack:///./src/utils/header.js","webpack:///external \"@babel/runtime/helpers/objectSpread\"","webpack:///external \"http-status-codes\"","webpack:///external \"isarray\"","webpack:///external \"joi\"","webpack:///external \"mongoose\"","webpack:///external \"ms\"","webpack:///external \"serialize-error\""],"names":["SCHEMA","joi","object","keys","identifier","string","trim","required","settings","resource","req","session","body","JSON","parse","values","validate","settingImage","settingImageService","create","statusCode","BAD_REQUEST","CREATED","settingImageIdentifier","pathParameters","get","NOT_FOUND","OK","mongo","uri","process","env","MONGODB_URI","ttl","MONGODB_TTL","apps","WEBAPP","EC_DEMO","connection","connectionExpiration","ms","config","connect","console","log","readyState","mongoose","createConnection","useNewUrlParser","useCreateIndex","bufferCommands","bufferMaxEntries","clearTimeout","setTimeout","close","register","modelName","schema","modelNames","includes","model","Promise","Schema","type","String","unique","index","Types","Mixed","default","timestamps","collection","getSession","authorization","normalizeHttpHeaders","headers","app","account","accountIdentifier","parseAuthorizationHeader","UNAUTHORIZED","transform","transformer","transformers","r","isArray","map","resourceType","logic","handler","context","callbackWaitsForEmptyEventLoop","stringify","error","isJoi","reason","details","INTERNAL_SERVER_ERROR","serializeError","SettingImageModel","createSettingImageModel","save","findOne","imageSetting","createdAt","Object","entries","reduce","name","value","toLocaleLowerCase","params","split","pair"],"mappings":"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","file":"src/handler.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/handler.js\");\n","import { BAD_REQUEST, CREATED } from 'http-status-codes'\nimport joi from 'joi'\n\nimport resource from 'rest/resource'\nimport config from 'infrastructure/config'\nimport settingImageService from 'services/setting-image'\n\nconst SCHEMA = joi.object().keys({\n  identifier: joi.string().trim().required(),\n  settings: joi.object()\n})\n\nexport default (resource('SETTING_IMAGE') (\n  async (req, session) => {\n    const body = JSON.parse(req.body)\n    const values = await joi.validate(body, SCHEMA)\n    const settingImage = await settingImageService.create(values)\n\n    if (!settingImage) {\n      return {\n        statusCode: BAD_REQUEST\n      }\n    }\n\n    return {\n      statusCode: CREATED,\n      resource: settingImage\n    }\n  }\n))\n","import { NOT_FOUND, OK } from 'http-status-codes'\nimport joi from 'joi'\n\nimport resource from 'rest/resource'\nimport config from 'infrastructure/config'\nimport settingImageService from 'services/setting-image'\n\nexport default (resource('SETTING_IMAGE') (\n  async (req, session) => {\n    const { settingImageIdentifier } = req.pathParameters\n\n    const settingImage = await settingImageService.get(settingImageIdentifier)\n\n    if (!settingImage) {\n      throw {\n        statusCode: NOT_FOUND\n      }\n    }\n\n    return {\n      statusCode: OK,\n      resource: settingImage\n    }\n  }\n))\n","export { default as SETTING__IMAGE___create } from './functions/setting-image/create'\nexport { default as SETTING__IMAGE___get } from './functions/setting-image/get'\n","export default {\n  mongo: {\n    uri: process.env.MONGODB_URI,\n    ttl: process.env.MONGODB_TTL\n  },\n  apps: {\n    WEBAPP: 'webapp',\n    EC_DEMO: 'ec-demo',\n  }\n}\n","// Using Mongoose With AWS Lambda: https://mongoosejs.com/docs/\nimport mongoose from 'mongoose'\nimport ms from 'ms'\nimport config from 'infrastructure/config'\n\nlet connection = null\nlet connectionExpiration = null\nconst ttl = ms(config.mongo.ttl || '30s')\n\nconst connect = async () => {\n  console.log('connect');\n  // Because `connection` is in the global scope, Lambda may retain it between\n  // function calls thanks to `callbackWaitsForEmptyEventLoop`.\n  // This means your Lambda function doesn't have to go through the\n  // potentially expensive process of connecting to MongoDB every time.\n  if (connection === null || connection.readyState !== 1) {\n    console.log('Connecting to MongoDB...')\n\n    connection = await mongoose.createConnection(config.mongo.uri, {\n      useNewUrlParser: true,\n      useCreateIndex: true,\n      // Buffering means mongoose will queue up operations if it gets\n      // disconnected from MongoDB and send them when it reconnects.\n      // With serverless, better to fail fast if not connected.\n      bufferCommands: false, // Disable mongoose buffering\n      bufferMaxEntries: 0 // and MongoDB driver buffering\n    })\n\n    console.log('MongoDB connected!')\n  } else {\n    console.log('Reuse alive MongoDB connection.')\n  }\n\n  // reset expiration\n  clearTimeout(connectionExpiration)\n\n  connectionExpiration = setTimeout(() => {\n    console.log('MongoDB Connection expired!')\n    connection.close()\n  }, ttl)\n\n  return connection\n}\n\nexport const register = async (modelName, schema) => {\n  const connection = await connect()\n\n  if (connection.modelNames().includes(modelName)) {\n    return connection.model(modelName)\n  } else {\n    return connection.model(modelName, schema)\n  }\n}\n\n// don't use `mpromise`\nmongoose.Promise = Promise\nexport default mongoose\n","import mongoose, { register } from 'infrastructure/mongoose'\n\nconst schema = mongoose.Schema({\n  identifier: {\n    type: String,\n    unique: true,\n    index: true\n  },\n  settings: {\n    type: mongoose.Schema.Types.Mixed,\n    default: {}\n  }\n}, {\n  timestamps: true,\n  collection: 'settingImage'\n})\n\nexport default () => register('SettingImage', schema)\n","import {\n  BAD_REQUEST,\n  INTERNAL_SERVER_ERROR,\n  UNAUTHORIZED\n} from 'http-status-codes'\nimport isArray from 'isarray'\nimport serializeError from 'serialize-error'\n\n// import accountService from 'services/account'\nimport * as transformers from 'transformers'\nimport {\n  normalizeHttpHeaders,\n  parseAuthorizationHeader\n} from 'utils/header'\n\nconst getSession = async (req) => {\n  const { authorization } = normalizeHttpHeaders(req.headers)\n  const {\n    app,\n    account: accountIdentifier,\n  } = parseAuthorizationHeader(authorization)\n\n  // const account = accountIdentifier ?\n  //   await accountService.get(accountIdentifier) :\n  //   null\n\n  if (accountIdentifier) {\n    throw UNAUTHORIZED\n  }\n\n  return {\n    app,\n    // account\n  }\n}\n\nconst transform = (type, resource) => {\n  const transformer = transformers[ type ] || ((r) => r)\n\n  return isArray(resource) ?\n    resource.map(transformer) :\n    transformer(resource)\n}\n\nexport default (resourceType) => (logic) => {\n  const handler = async (req, context) => {\n    // Make sure to add this so you can re-use `connnection` between function calls.\n    // See https://www.mongodb.com/blog/post/serverless-development-with-nodejs-aws-lambda-mongodb-atlas\n    context.callbackWaitsForEmptyEventLoop = false\n\n    try {\n      const session = await getSession(req)\n\n      const {\n        resource,\n        statusCode\n      } = await logic(req, session)\n\n      return {\n        statusCode,\n        body: resource ?\n          JSON.stringify(transform(resourceType, resource)) :\n          null\n      }\n    } catch (error) {\n      // validation error\n      if (error.isJoi) {\n        return {\n          statusCode: BAD_REQUEST,\n          body: JSON.stringify({\n            reason: error.details\n          })\n        }\n      }\n\n      return {\n        statusCode: error.statusCode || INTERNAL_SERVER_ERROR,\n        body: JSON.stringify({\n          reason: serializeError(error.reason || error)\n        })\n      }\n    }\n  }\n\n  handler.logic = logic\n\n  return handler\n}\n","import createSettingImageModel from 'models/setting-image'\n\nconst create = async ({ identifier, settings = {} }) => {\n\n  const SettingImageModel = await createSettingImageModel()\n\n  const settingImage = await new SettingImageModel({\n    identifier,\n    settings\n  }).save()\n\n  if (!settingImage) {\n    return null\n  }\n\n  return settingImage\n}\n\nconst get = async (identifier) => {\n  const SettingImageModel = await createSettingImageModel()\n\n  return await SettingImageModel.findOne({\n    identifier\n  })\n}\n\n// // TODO:  auto delete if upload handler from upload tool\n\nexport default {\n  create,\n  get\n}\n","export { default as SETTING_IMAGE } from './setting-image'\n","export default (imageSetting) => ({\n  identifier: imageSetting.identifier,\n  settings: imageSetting.settings,\n  timestamps: imageSetting.timestamps,\n  createdAt: imageSetting.createdAt\n})\n","export const normalizeHttpHeaders = (headers) => Object.entries(headers).reduce(\n  (headers, [ name, value ]) => ({\n    ...headers,\n    [ name.toLocaleLowerCase() ]: value\n  }),\n  {}\n)\n\nexport const parseAuthorizationHeader = (value) => {\n  const [ type, params ] = value.split(' ')\n\n  return {\n    type,\n    ...(\n      params.split(',').reduce(\n        (map, pair) => {\n          const [ name, value ] = pair.split('=')\n\n          return {\n            ...map,\n            [ name ]: value\n          }\n        }, {}\n      )\n    )\n  }\n}\n","module.exports = require(\"@babel/runtime/helpers/objectSpread\");","module.exports = require(\"http-status-codes\");","module.exports = require(\"isarray\");","module.exports = require(\"joi\");","module.exports = require(\"mongoose\");","module.exports = require(\"ms\");","module.exports = require(\"serialize-error\");"],"sourceRoot":""}